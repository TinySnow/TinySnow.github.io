# 算术逻辑单元

## 复习

5. 由基础逻辑门（与或非三门）搭建了更复杂的逻辑门：异或门，同或门，多路选择器
6. 设计完成了半加器，可以完成两个一位二进制数的加法，但不能处理来自低位的进位
7. 设计完成了加法器，可以处理三个输入（两个加数和一个进位），并可以串联构成多位加法器
8. 掌握了原码、反码和补码的概念，理解了补码可以统一加减法运算
9. 设计完成了减法器，本质是加上一个负数（补码）
10. 设计完成了乘法器，本质是移位和加法的组合
11. 设计完成了除法器，本质是移位和减法的组合

## TL;DR

- 算术逻辑单元（ALU）是计算机的核心部件，负责执行所有的算术和逻辑运算
- ALU 集成了加法器、减法器、乘法器和除法器等基本运算单元
- 通过控制信号选择不同的运算路径，实现不同的运算功能
- ALU 的设计需要在性能、面积和功耗之间进行权衡

## 正文

### 引子

　　我们已经设计了各种运算器：加法器可以做加法，减法器通过补码实现减法，乘法器通过移位和加法实现乘法，除法器通过移位和减法实现除法。但在实际的计算机中，这些运算器并不是独立存在的，而是被整合在一个叫做"算术逻辑单元"（Arithmetic Logic Unit，简称 ALU）的部件中。

### ALU 的本质

　　ALU 是计算机的"计算中心"，负责执行所有的算术运算（加减乘除）和逻辑运算（与、或、非等）。它的工作原理是：

1. 接收输入数据
2. 根据控制信号选择要执行的运算
3. 执行相应的运算
4. 输出结果

### ALU 的基本结构

　　一个基本的 ALU 包含以下部件：

1. **数据通路**：
   - 输入数据的通路
   - 输出数据的通路
   - 内部数据的传输线路

2. **运算单元**：
   - 加法器（可用于加法和减法）
   - 移位器（用于乘除法）
   - 逻辑运算单元（与、或、非等）

3. **控制单元**：
   - 操作码译码器（决定执行什么运算）
   - 时序控制电路（控制运算过程）
   - 状态标志位（记录运算结果的特征）

4. **寄存器**：
   - 临时存储运算数据
   - 存储中间结果
   - 存储最终结果

### 运算的统一性

　　ALU 的一个重要特点是运算的统一性：

1. **加减统一**：
   - 减法转换为加上负数
   - 负数用补码表示
   - 只需要一个加法器

2. **乘除复用**：
   - 乘法使用加法器和移位器
   - 除法使用减法器（实际上还是加法器）和移位器
   - 通过不同的控制信号实现不同的功能

### 控制信号

　　ALU 通过控制信号来决定执行什么运算。以 4 位控制信号为例：

| 控制信号 | 功能 |
| :---: | :--- |
| 0000 | 加法 |
| 0001 | 减法 |
| 0010 | 乘法 |
| 0011 | 除法 |
| 0100 | 与运算 |
| 0101 | 或运算 |
| 0110 | 异或运算 |
| 0111 | 非运算 |

### 状态标志

　　ALU 在运算后会设置一些状态标志，用于表示运算的结果特征：

1. **零标志（Zero Flag）**：
   - 结果是否为零
   - 用于条件判断

2. **符号标志（Sign Flag）**：
   - 结果是否为负数
   - 用于有符号运算

3. **进位标志（Carry Flag）**：
   - 是否产生进位
   - 用于无符号运算

4. **溢出标志（Overflow Flag）**：
   - 是否发生溢出
   - 用于有符号运算

### 优化设计

　　现代 ALU 的设计需要考虑多个方面：

1. **性能优化**：
   - 使用超前进位加法器
   - 实现 Booth 乘法算法
   - 采用不恢复余数除法

2. **面积优化**：
   - 复用硬件资源
   - 优化电路布局
   - 减少冗余逻辑

3. **功耗优化**：
   - 使用时钟门控
   - 优化数据路径
   - 减少无效运算

### 实际应用

　　让我们看一个简单的例子，计算 `(5 + 3) × 2`：

1. 第一步：5 + 3
   ```
   控制信号：0000（加法）
   输入A：0101（5）
   输入B：0011（3）
   结果：1000（8）
   ```

2. 第二步：8 × 2
   ```
   控制信号：0010（乘法）
   输入A：1000（8）
   输入B：0010（2）
   结果：10000（16）
   ```

**思考题 1**

> 　　为什么大多数 ALU 都采用补码表示负数？

**思考题 2**

> 　　ALU 是如何处理浮点数运算的？

## 小结

### 知识点

- ALU 的基本结构
- 控制信号的作用
- 状态标志的含义
- 运算的统一性
- 优化设计方法

### 思考题答案（仅供参考）

#### 思考题 1

　　补码有以下优点：
1. 统一了加减法运算，只需要加法器
2. 零的表示是唯一的
3. 可以多一个负数（如 8 位补码可以表示 -128 到 +127）
4. 补码的运算规则简单，便于硬件实现

#### 思考题 2

　　浮点数运算比整数复杂得多：
1. 需要单独的浮点运算单元（FPU）
2. 需要处理对阶、尾数运算、规格化等步骤
3. 需要考虑精度损失和舍入方式
4. 需要处理特殊值（如 NaN、无穷大）

## 参考资料

1. [Wikipedia(zh)：算术逻辑单元](https://zh.wikipedia.org/wiki/%E7%AE%97%E8%A1%93%E9%82%8F%E8%BC%AF%E5%96%AE%E5%85%83)：ALU 的详细介绍
2. [Wikipedia(zh)：浮点运算单元](https://zh.wikipedia.org/wiki/%E6%B5%AE%E7%82%B9%E8%BF%90%E7%AE%97%E5%8D%95%E5%85%83)：FPU 的基本概念

### 推荐

- [Bilibili：计算机是如何做运算的](https://www.bilibili.com/video/BV1Zr4y1S7gG/)

## 协议

　　本作品采用[知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可。
