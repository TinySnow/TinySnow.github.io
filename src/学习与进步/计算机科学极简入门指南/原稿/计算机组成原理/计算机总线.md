# 计算机总线

## 复习

1. 了解了CPU的基本组成
2. 掌握了数据通路的概念
3. 理解了指令执行过程

## TL;DR

- 总线是计算机组件间的公共通信通道
- 总线分为地址总线、数据总线和控制总线
- 总线协议确保数据传输的可靠性
- 现代计算机采用分层总线结构

## 正文

### 总线的基本概念

#### 1. 总线定义

1. **功能特点**：
   - 公共传输通道
   - 多设备共享
   - 标准接口

2. **基本类型**：
   ```
   +-------------+    +-----------+
   |    CPU     |<-->| 系统总线   |
   +-------------+    +-----------+
                          |
   +-------------+        |
   |   内存     |<-------|
   +-------------+        |
   +-------------+        |
   |  I/O设备   |<-------|
   +-------------+
   ```

#### 2. 总线分类

1. **按功能分类**：
   - 地址总线：传送地址
   - 数据总线：传送数据
   - 控制总线：传送控制信号

2. **按层次分类**：
   - 内部总线：芯片内部
   - 系统总线：主板级别
   - 外部总线：外设连接

### 总线的工作原理

#### 1. 总线事务

1. **读操作流程**：
   ```
   1. CPU发送地址到地址总线
   2. CPU激活读信号
   3. 目标设备响应
   4. 数据通过数据总线返回
   ```

2. **写操作流程**：
   ```
   1. CPU发送地址到地址总线
   2. CPU发送数据到数据总线
   3. CPU激活写信号
   4. 目标设备接收数据
   ```

#### 2. 总线时序

1. **同步时序**：
   ```
   时钟信号：  _|-|_|-|_|-|_|-|_
   地址总线：  ==|A1|==|A2|==|A3|
   数据总线：  ==|D1|==|D2|==|D3|
   读写信号：  __|--|__|--|__|--|
   ```

2. **异步时序**：
   ```
   请求信号：  __|------|______|---
   确认信号：  ______|------|______
   数据有效：  ===|数据|====|数据|==
   ```

### 总线标准

#### 1. 常见总线标准

1. **系统总线**：
   - PCI总线
   - PCIe总线
   - AGP总线

2. **外部总线**：
   - USB总线
   - SATA总线
   - Thunderbolt

#### 2. PCIe总线示例

1. **基本特征**：
   ```
   传输速率：
   PCIe 1.0: 2.5 GT/s
   PCIe 2.0: 5.0 GT/s
   PCIe 3.0: 8.0 GT/s
   PCIe 4.0: 16.0 GT/s
   ```

2. **链路结构**：
   ```
   +--------+    +--------+
   | PCIe x1|    |  通道1 |
   +--------+    +--------+
   | PCIe x4|    |  通道4 |
   +--------+    +--------+
   | PCIe x8|    |  通道8 |
   +--------+    +--------+
   |PCIe x16|    | 通道16 |
   +--------+    +--------+
   ```

### 总线仲裁

#### 1. 仲裁方式

1. **集中仲裁**：
   ```
   设备1 ----+
   设备2 ----|
   设备3 ----|-> 仲裁器 -> 总线控制
   设备4 ----|
   ```

2. **分布仲裁**：
   ```
   设备1 <-> 设备2 <-> 设备3 <-> 设备4
      |        |        |        |
      +--------+--------+--------+
            总线控制链
   ```

#### 2. 仲裁算法

1. **固定优先级**：
   - 设备优先级固定
   - 响应快但不公平

2. **轮询方式**：
   - 循环访问各设备
   - 公平但可能延迟

3. **动态优先级**：
   - 根据需求调整
   - 平衡性能和公平

### 总线性能

#### 1. 性能指标

1. **带宽**：
   ```
   带宽 = 总线宽度 × 工作频率
   例如：
   32位×100MHz = 3.2GB/s
   ```

2. **总线效率**：
   ```
   效率 = 有效传输时间 / 总线周期时间
   例如：
   传输时间：80ns
   周期时间：100ns
   效率 = 80%
   ```

#### 2. 性能优化

1. **突发传输**：
   ```
   普通传输：A1->D1, A2->D2, A3->D3
   突发传输：A1->D1,D2,D3,D4,D5
   ```

2. **数据缓冲**：
   ```
   设备1 -> 缓冲区 -> 总线 -> 缓冲区 -> 设备2
   ```

**思考题**

> 　　在设计一个新的计算机系统时，如何选择合适的总线架构？需要考虑哪些因素？

## 小结

### 知识点

- 总线的基本概念和类型
- 总线的工作原理和时序
- 总线标准和仲裁机制
- 总线性能优化方法

### 思考题答案（仅供参考）

　　选择总线架构需考虑：

1. **性能需求**：
   - 带宽要求
   - 延迟要求
   - 实时性要求

2. **系统规模**：
   - 设备数量
   - 扩展需求
   - 成本限制

3. **兼容性**：
   - 现有设备支持
   - 未来升级空间
   - 标准遵循

4. **应用场景**：
   - 使用环境
   - 可靠性要求
   - 功耗限制

## 参考资料

1. [Wikipedia(zh)：计算机总线](https://zh.wikipedia.org/wiki/%E6%80%BB%E7%BA%BF)：总线的基本概念
2. [Wikipedia(zh)：PCI Express](https://zh.wikipedia.org/wiki/PCI_Express)：PCIe总线标准
3. [Wikipedia(zh)：系统总线](https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E6%80%BB%E7%BA%BF)：系统总线架构

## 协议

　　本作品采用[知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可。
