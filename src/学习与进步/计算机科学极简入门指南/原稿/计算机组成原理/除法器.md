# 除法器

## 复习

1. 第六章：设计完成了半加器，可以完成两个一位二进制数的加法，但不能处理来自低位的进位
2. 第七章：设计完成了加法器，可以处理三个输入（两个加数和一个进位），并可以串联构成多位加法器
3. 第八章：掌握了原码、反码和补码的概念，理解了补码可以统一加减法运算
4. 第九章：设计完成了减法器，本质是加上一个负数（补码）
5. 第十章：设计完成了乘法器，本质是移位和加法的组合，也可以用 Booth 算法等进行优化

## TL;DR

- 除法可以转换为多次减法和移位
- 除法器的核心是减法器和移位器
- 除法需要处理除数为零和溢出的特殊情况

## 正文

### 本质

　　加减乘都有了，除法也该来了。除法是乘法的逆运算，但实现起来比乘法要复杂得多。

　　回忆小学怎样算除法。列竖式，试商，减，移位，再试商，再减，再移位……除法本质是反复减法和移位。

```
  23 ÷ 5 = 4 余 3

   23 | 5
  -20 | 4
   --
    3
```

　　实际上是：
1. 试商：23 能减几个 5？
2. 减法：23 - 4×5 = 3
3. 结果：商 4，余数 3

### 二进制除法

　　十进制可以这样算，二进制呢？

　　不妨来试试：`15 ÷ 3 = 5`。简单起见，使用无符号数。

```
   1111 | 0011
  -1100 | 0101
   ----
    0011
   -0011
   ----
    0000
```

　　分析一下过程：
1. 1111 (15) 能否减去 1100 (3×4=12)？能，商 4
2. 余数 0011 (3) 能否减去 0011 (3×1=3)？能，商 1
3. 余数 0000，除法结束
4. 最终商 0101 (5)，余数 0000

　　二进制除法的一个好处是：试商时只需要判断能不能减，因为商只可能是 0 或 1。

### 除法器的构成

　　根据上面的分析，除法器需要以下部件：

1. **减法器**：
   - 用于判断是否可以减去除数
   - 如果可以减，商为 1
   - 如果不可以减，商为 0

2. **移位器**：
   - 对被除数（余数）进行移位
   - 对商进行移位

3. **控制电路**：
   - 控制整个除法过程
   - 判断是否结束
   - 处理特殊情况（除数为 0 等）

### 具体实现

　　以 15 ÷ 3 为例，看看除法器是如何工作的：

1. 第一步：
   ```
   被除数：1111 (15)
   除数：  0011 (3)
   可以减，商 1
   余数：  0011 (3)
   ```

2. 第二步：
   ```
   被除数：0011 (3)
   除数：  0011 (3)
   可以减，商 1
   余数：  0000 (0)
   ```

3. 最终结果：
   - 商：0101 (5)
   - 余数：0000 (0)

### 优化思路

　　上述设计虽然可行，但效率较低。可以进行以下优化：

1. **恢复余数法**：
   - 每次试商后，如果不能减就恢复原来的余数
   - 简单但效率低

2. **不恢复余数法**：
   - 如果不能减，下一步加回来
   - 避免了恢复原余数的步骤
   - 但需要更复杂的控制电路

### 特殊情况处理

1. **除数为 0**：
   - 需要检测并报错
   - 在硬件上通常会触发异常

2. **溢出**：
   - 当商太大时会发生
   - 需要检测并处理

**思考题 1**

> 　　除法器中的移位操作是左移还是右移？为什么？

**思考题 2**

> 　　如果要计算带符号数的除法，需要注意什么？

## 小结

### 知识点

- 除法的本质是反复减法
- 二进制除法的特点
- 除法器的基本构成
  - 减法器
  - 移位器
  - 控制电路
- 除法器的优化方法
- 特殊情况处理

## 参考资料

1. [Wikipedia(zh)：除法](https://zh.wikipedia.org/wiki/%E9%99%A4%E6%B3%95)：除法的基本概念
2. [Wikipedia(zh)：不恢复余数除法](https://zh.wikipedia.org/wiki/%E4%B8%8D%E6%81%A2%E5%A4%8D%E4%BD%99%E6%95%B0%E9%99%A4%E6%B3%95)：一种优化的除法算法

### 推荐

- [Bilibili：计算机如何计算除法](https://www.bilibili.com/video/BV1Jb4y1x7Dw/)

### 思考题答案（仅供参考）

#### 思考题 1

　　除法器中通常使用左移操作：
1. 被除数（余数）左移一位，相当于乘 2
2. 这样可以逐步处理每一位商
3. 最后得到的商不需要移位

#### 思考题 2

　　带符号数除法需要考虑：
1. 结果的符号由两个操作数的符号决定
   - 同号得正，异号得负
2. 先将操作数转换为绝对值进行除法
3. 根据符号规则确定最终结果的符号
4. 如果结果为负，需要转换为补码表示
5. 需要特别注意最小负数的处理

## 协议

　　本作品采用[知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可。
